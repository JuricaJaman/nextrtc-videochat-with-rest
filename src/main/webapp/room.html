<!DOCTYPE html>
<html>
<head>
    <title>Room</title>
</head>
<body>
<div>
    <h2>
        <span>Give your friends this link: </span>
        <span id="joinLink"></span>
    </h2>
    <video id="local" autoplay></video>
    <video id="remote" autoplay></video>
    <br/>
    <ul id="eventLog">

    </ul>
</div>
<script src="https://webrtc.github.io/samples/src/js/adapter.js"></script>
<script src="js/nextRTC.js"></script>
<script src="js/jquery-2.1.3.min.js"></script>
<script>
        var nextRTC = new NextRTC({
            wsURL : 'wss://localhost:8433/signaling',
            mediaConfig : {
                video : true,
                audio : true,
            },
            peerConfig : {
                'iceServers' : [ {
                    url : "stun:stun.l.google.com:19302"
                } ]
            },
        });

        nextRTC.on('created', function(nextRTC, event) {
            console.log(JSON.stringify(event));
            $('#eventLog').append('<li>' + 'Room with id ' + event.content + ' has been created, share it with your friend to start videochat' + '</li>')
        });

        nextRTC.on('joined', function(nextRTC, event) {
            console.log(JSON.stringify(event));
            $('#eventLog').append('<li>' + 'Member with id ' + event.from + ' joined conversation' + '</li>')
        });

        nextRTC.on('localStream', function(nextRTC, stream) {
            window.stream = stream.stream; // make variable available to browser console
            var video = $('#local')[0];
            video.srcObject = stream.stream;
            $('#eventLog').append('<li>Attached local media stream!</li>')
        });

        nextRTC.on('remoteStream', function(nextRTC, stream) {
            window.stream = stream.stream; // make variable available to browser console
            var video = $('#remote')[0];
            video.srcObject = stream.stream;
            $('#eventLog').append('<li>Attached remote media stream!</li>')
        });

        nextRTC.on('left', function(nextRTC, event) {
            console.log(JSON.stringify(event));
            $('#eventLog').append('<li>'+ event.from +' has left the conversation</li>')
        });

        var searchParams = new URLSearchParams(document.URL);
        var type = searchParams.get('type');
        var name = searchParams.get('name');

        if(type != undefined){
            nextRTC.create(name, {type : type});
        } else {
            nextRTC.join(name, {type : type});
        }
        $('#joinLink').append(location.protocol + '//' + location.host + location.pathname + '?name=' + name);


</script>
</body>
</html>